// This is your Prisma schema file

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Note {
  id        String   @id @default(cuid())
  title     String
  content   String   // Original markdown content
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  authors   Author[]
  works     Work[]
  quizSessions QuizSession[]
}

model Author {
  id     String @id @default(cuid())
  name   String
  noteId String
  note   Note   @relation(fields: [noteId], references: [id], onDelete: Cascade)
  works  Work[]
  
  @@index([noteId])
}

model Work {
  id              String  @id @default(cuid())
  title           String
  publicationDate String  // Stored as string for flexibility (e.g., "1813", "March 1925")
  year            Int     // Extracted year for sorting
  authorId        String
  noteId          String
  imageUrl        String? // Generated preview image
  
  author          Author  @relation(fields: [authorId], references: [id], onDelete: Cascade)
  note            Note    @relation(fields: [noteId], references: [id], onDelete: Cascade)
  
  @@index([noteId])
  @@index([authorId])
  @@index([year])
}

model QuizSession {
  id          String   @id @default(cuid())
  noteId      String
  score       Int
  totalQuestions Int
  completedAt DateTime @default(now())
  
  note        Note     @relation(fields: [noteId], references: [id], onDelete: Cascade)
  questions   QuizQuestion[]
  
  @@index([noteId])
}

model QuizQuestion {
  id            String  @id @default(cuid())
  sessionId     String
  question      String
  options       String  // JSON array of options
  correctAnswer String
  userAnswer    String?
  isCorrect     Boolean?
  
  session       QuizSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  
  @@index([sessionId])
}
